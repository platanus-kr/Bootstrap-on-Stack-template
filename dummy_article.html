

	<h1>
		Latest Posts	</h1>
	<ul class="list-unstyled">
				<li>
			<h2>
				<a href="https://platanus.org/stack-devel/%eb%af%b8-%eb%b6%84%eb%a5%98/20" title="Spring5; AOP" rel="bookmark">
					Spring5; AOP				</a>
			</h2>
			<time datetime="2021-02-13" pubdate>
				2021ë…„ 02ì›” 13ì¼ 3:01 ì˜¤ì „			</time>
			<span><span class="screen-reader-text">Spring5; AOP</span>ì˜ ëŒ“ê¸€ì„ ê»ìŠµë‹ˆë‹¤</span>			
<h1>ìŠ¤í”„ë§ AOPì˜ ì‹¤ì œ #1</h1>



<ul><li>ìŠ¤í”„ë§ì—ì„œ í”„ë¡ì‹œ íŒ¨í„´ì„ ì–´ë–»ê²Œ ì ìš©ì‹œí‚¤ëŠ”ì§€ ì‹¤ì œë¡œ ìŠ¤í”„ë§ì„ í†µí•´ ì ìš©í•´ë³¸ë‹¤.</li><li><code>proxy íŒ¨í„´</code>ì€ <code>decorator ê°ì²´</code> ë¡œë„ í™œìš©í•  ìˆ˜ ìˆë‹¤. ê¸°ëŠ¥ ì¶”ê°€ì™€ í™•ì¥ì— ì´ˆì ì´ ë§ì¶°ì ¸ìˆë‹¤.</li></ul>



<h2>ì§¤ë§‰í•œ í”„ë¡ì‹œì˜ í•µì‹¬</h2>



<ul><li>í”„ë¡ì‹œì˜ íŠ¹ì§•ì€ í•µì‹¬ ê¸°ëŠ¥ì€ êµ¬í˜„í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì´ë‹¤.</li><li>í”„ë¡ì‹œëŠ” í•µì‹¬ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì§€ ì•ŠëŠ” ëŒ€ì‹  ì—¬ëŸ¬ ê°ì²´ì— ê³µí†µìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.</li><li>AOPì˜ ê¸°ë³¸ í•µì‹¬ì€ <strong>ê³µí†µ ê¸°ëŠ¥ì„ ì‚½ì…í•˜ëŠ” ê²ƒ</strong> ì´ë‹¤.</li></ul>



<h2>AOPì˜ ì£¼ìš” ìš©ì–´</h2>



<h3>1. Advice</h3>



<ul><li>ê³µí†µ ê´€ì‹¬ ê¸°ëŠ¥ì„ í•µì‹¬ ë¡œì§ì— ì ìš©í•˜ëŠ” ì‹œì ì„ ì •ì˜í•œë‹¤.</li><li>ex) <strong>ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „</strong>ì— <strong>íŠ¸ëœì­ì…˜ì„ ì‹œì‘</strong>í•˜ëŠ” ê¸°ëŠ¥ì„ ì ìš©í•œë‹¤.</li></ul>



<h3>2. Joinpoint</h3>



<ul><li>Adviceë¥¼ <strong>ì ìš©í•˜ëŠ” ì§€ì </strong>ì„ ì˜ë¯¸í•œë‹¤.</li><li>ë©”ì†Œë“œ í˜¸ì¶œ, í•„ë“œ ê°’ ë³€ê²½ ë“±ì„ í¬í•¨í•œë‹¤.</li><li>ìŠ¤í”„ë§ì€ ë©”ì†Œë“œ í˜¸ì¶œì— ëŒ€í•œ Joinpointë§Œ ì§€ì›.</li></ul>



<h3>3. Pointcut</h3>



<ul><li>Adviceê°€ <strong>ì‹¤ì œ ì ìš©ë˜ëŠ” Joinpoint</strong>ë¥¼ ì˜ë¯¸í•œë‹¤.</li><li>ìŠ¤í”„ë§ì—ì„œëŠ” ì •ê·œí‘œí˜„ì‹ì´ë‚˜ AspectJì˜ ë¬¸ë²•ì„ ì´ìš©í•´ Poincutì„ ì •ì˜í•œë‹¤.</li></ul>



<h3>4. Weaving</h3>



<ul><li>Adviceë¥¼ í•µì‹¬ <strong>ë¡œì§ ì½”ë“œì— ì ìš©í•˜ëŠ” í–‰ìœ„</strong>.</li></ul>



<h3>5. Aspect</h3>



<ul><li>ì—¬ëŸ¬ ê°ì²´ì— ê³µí†µìœ¼ë¡œ ì ìš©ë˜ëŠ” ê¸°ëŠ¥ì„ Aspectë¼ê³  í•œë‹¤.</li></ul>



<h2>Aspectì˜ ì¢…ë¥˜</h2>



<ul><li>ìŠ¤í”„ë§ì—ì„œ êµ¬í˜„ ê°€ëŠ¥í•œ Aspectì˜ ì¢…ë¥˜</li></ul>



<ol><li>Before Advice : <strong>ë©”ì†Œë“œ í˜¸ì¶œ ì „</strong> Aspectë¥¼ ì‹¤í–‰í•œë‹¤.</li><li>After Returning Advice : <strong>ë©”ì†Œë“œê°€</strong> Exception ì—†ì´ <strong>ì‹¤í–‰ ëœ ì´í›„</strong> Aspectë¥¼ ì‹¤í–‰í•œë‹¤.</li><li>After Throwing Advice : <strong>ë©”ì†Œë“œê°€ Exception ì´ ë°œìƒí•œ ê²½ìš°</strong> Aspectë¥¼ ì‹¤í–‰í•œë‹¤.</li><li>After Advice : <strong>Exception ìƒê´€ ì—†ì´</strong> ë©”ì†Œë“œ ì‹¤í–‰ í›„ Aspectë¥¼ ì‹¤í–‰í•œë‹¤.</li><li>ğŸ“Œ <strong>Around Advice</strong> : ë©”ì†Œë“œ ì‹¤í–‰ ì „, í›„, Exception ë°œìƒ ì‹œì ì— Aspectë¥¼ ì‹¤í–‰í•œë‹¤.</li></ol>



<blockquote class="wp-block-quote"><p>ì´ ì¤‘ì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ”ê²ƒì€ <strong>Around Advice</strong> ë°©ì‹ì¸ë°, ì‹œì ì„ ë‹¤ì–‘í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p></blockquote>



<h2>ìŠ¤í”„ë§ì˜ AOPêµ¬í˜„</h2>



<ul><li>í”„ë¡ì‹œë¥¼ <strong>ì ìš©í•  í´ë˜ìŠ¤</strong>ì— @Aspect ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì¸ë‹¤.</li><li>@Pointcut ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ <strong>Joinpoint ë¥¼ ì§€ì •</strong>í•œë‹¤.</li><li><strong>ê³µí†µ ê¸°ëŠ¥ì„ êµ¬í˜„í•œ ë©”ì†Œë“œ</strong>ì— @Around ì–´ë…¸í…Œì´ì…˜ì„ ì§€ì •í•œë‹¤.</li></ul>



<h3>1. @Aspect, @Pointcut, @Aroundë¥¼ ì´ìš©í•œ AOP êµ¬í˜„</h3>



<ul><li><a href="https://git.canxan.com/platanus/java-spring-study/-/commit/9f8f8d9b165b01bf58537fe6ecedcde450b0b20a">ìŠ¤í”„ë§AOP ì ìš© í•˜ê¸° ì´ì „ í”„ë¡ì‹œ íŒ¨í„´ ì½”ë“œ</a><ul><li>ì½”ë“œì˜ ìš”ì ì€ <code>ExecutiveTimeCacluator</code>í´ë˜ìŠ¤ì˜ ìƒì„±ìì—ì„œ êµ¬í˜„ì²´ë¥¼ ìœ„ì„(delegate) ë°›ì•„ í”„ë¡ì‹œë¥¼ êµ¬í˜„í•œë‹¤ëŠ” ì ì´ë‹¤.</li></ul></li><li>ë‹¤ìŒì€ ê¸°ì¡´ ì½”ë“œì— ì–´ë…¸í…Œì´ì…˜ì„ ì ìš©í–ˆë‹¤</li></ul>



<pre class="wp-block-code"><code lang="java" class="language-java">@Aspect
public class ExecutiveTimeAspect {

    @Pointcut("execution(public * chap07..*(..))")
    private void publicTarget() {
    }

    @Around("publicTarget()")
    public Object measure(ProceedingJoinPoint joinPoint) throws Throwable {
        long start = System.nanoTime();
        try {
            Object result = joinPoint.proceed();
            return result;
        } finally {
            long finish = System.nanoTime();
            Signature signature = joinPoint.getSignature();
            System.out.printf("%s.%s(%s) runtime : %s ns\n",
                joinPoint.getTarget().getClass().getSimpleName(),
                signature.getName(), Arrays.toString(joinPoint.getArgs()),
                (finish - start));
        }
    }</code></pre>



<ul><li>@Aspect ì–´ë…¸í…Œì´ì…˜ì„ ì ìš©í•œ í´ë˜ìŠ¤ëŠ” Advice(@Around)ì™€ Pointcutì„ ì œê³µí•œë‹¤.</li><li>@Pointcut ì–´ë…¸í…Œì´ì…˜ì€ <strong>ê³µí†µ ê¸°ëŠ¥ì„ ì ìš©í•  ëŒ€ìƒì„ ì§€ì •</strong>í•œë‹¤.</li><li>@Around ì–´ë…¸í…Œì´ì…˜ì€ <code>publicTarget()</code>ì˜ pointcutì— ê³µí†µ ê¸°ëŠ¥ì„ ì ìš©í•œë‹¤ëŠ” ì˜ë¯¸ë‹¤.<ul><li>measure()ì˜ <code>ProceedingJoinPoint</code> íƒ€ì… íŒŒë§ˆë¦¬í„°ëŠ” <strong>í”„ë¡ì‹œ ëŒ€ìƒ ê°ì²´ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ì‚¬ìš©</strong>í•œë‹¤.</li><li><code>joinPoint.proceed()</code> ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ëŒ€ìƒ ê°ì²´ì˜ ë©”ì†Œë“œê°€ ì‹¤í–‰ë˜ë¯€ë¡œ ì´ ì½”ë“œ ì´ì „ê³¼ ì´í›„ì— ê³µí†µ ê¸°ëŠ¥ì„ ìœ„í•œ ì½”ë“œë¥¼ ìœ„ì¹˜ì‹œí‚¤ë©´ ëœë‹¤. (ê¸°ì¡´ ì½”ë“œì˜ delegate ìœ„ì¹˜ì™€ ê°™ë‹¤)</li></ul></li></ul>



<h4>Beanì„¤ì •</h4>



<pre class="wp-block-code"><code class="">@Configuration
@EnableAspectJAutoProxy
public class AppContext {

    @Bean
    public ExecutiveTimeAspect executiveTimeAspect() {
        return new ExecutiveTimeAspect();
    }

    @Bean
    public Calculator calculator() {
        return new ReCalculator();
    }
}</code></pre>



<ul><li>@EnableAspectJAutoProxy ì–´ë…¸í…Œì´ì…˜ì„ bean ì„¤ì •ì— ë¶™ì´ë©´, @Aspect í´ë˜ìŠ¤ë¥¼ ê³µí†µ ê¸°ëŠ¥ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</li><li>ìŠ¤í”„ë§ì€ @Aspect ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ bean ê°ì²´ë¥¼ ì°¾ì•„ @Pointcut ì„¤ì •ê³¼ @Around ì„¤ì •ì„ ì‚¬ìš©í•œë‹¤.</li></ul>



<h4>ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ</h4>



<pre class="wp-block-code"><code class="">public class MainAspect {

    public static void main(String[] args) {

        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(
            AppContext.class);

        Calculator calculator = context.getBean("calculator", Calculator.class);
        long fiveFactorial = calculator.factorial(5);
        System.out.println("calculator.factorial(5) = " + fiveFactorial);
        System.out.println(calculator.getClass().getName());
        context.close();
    }</code></pre>



<ul><li>ì•„ë˜ëŠ” ì‹¤í–‰ ê²°ê³¼ë‹¤</li></ul>



<pre class="wp-block-code"><code class="">ReCalculator.factorial([5]) runtime : 22574 ns
calculator.factorial(5) = 120
com.sun.proxy.$Proxy17</code></pre>



<ul><li>ì²«ë²ˆì§¸ ì¤„ì€ <code>ExecutiveCalculatorAspect</code>í´ë˜ìŠ¤ì˜ <code>measure()</code>ê°€ ì¶œë ¥í•œ ê²ƒì´ë‹¤.</li><li>ì„¸ë²ˆì§¸ ì¤„ì€ <code>MainAspect</code>ì˜ mainì—ì„œ <code>getName()</code>ì„ ì¶œë ¥í•œ ê²ƒì´ë‹¤.</li><li>ì•„ë˜ì™€ ê°™ì€ ì‹¤í–‰ êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.<br><img src=":/a09904f7c47d409caecb92b6602187fa" alt="f14cee07d5337be2cecc716a333c92ab.png"></li><li>ì—¬ê¸°ì„œ AOPë¥¼ ì ìš©í•˜ì§€ ì•Šìœ¼ë©´ <code>$Proxy17</code> ëŒ€ì‹  <code>ReCalculator</code>ë¥¼ ë°˜í™˜í•œë‹¤. (ExecutiveTimeAspect beanì„¤ì • ì£¼ì„ì²˜ë¦¬)</li></ul>



<pre class="wp-block-code"><code class="">calculator.factorial(5) = 120
chap07.ReCalculator</code></pre>



<h3>ProceedingJoinPointì˜ ë©”ì†Œë“œ</h3>



<ul><li>Around Advice ë°©ì‹ì—ì„œ ì‚¬ìš©í•  ê³µí†µ ê¸°ëŠ¥ ë©”ì†Œë“œëŠ” ëŒ€ë¶€ë¶„ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë°›ì€ <code>ProceedingJoinPoint</code>ì˜ <code>proceed()</code>ë©”ì†Œë“œë§Œ í˜¸ì¶œí•˜ë©´ ëœë‹¤.</li></ul>



<h4><code>ProceedingJoinPoint</code> ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ë©”ì†Œë“œ</h4>



<ul><li><code>Signature getSignature()</code>: í˜¸ì¶œ ë˜ëŠ” ë©”ì†Œë“œì— ëŒ€í•œ ì •ë³´ë¥¼ êµ¬í•œë‹¤.</li><li><code>Object getTarget()</code>: ëŒ€ìƒ ê°ì²´ë¥¼ êµ¬í•œë‹¤.</li><li><code>Object[] getArgs()</code>: íŒŒë¼ë¯¸í„° ëª©ë¡ì„ êµ¬í•œë‹¤.</li></ul>



<h4><code>org.aspectj.lang.Signature</code> ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ë©”ì†Œë“œ</h4>



<ul><li><code>String getName()</code>: í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œì˜ ì´ë¦„ì„ êµ¬í•œë‹¤.</li><li><code>String toLongString()</code>: í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œì˜ ëª¨ë“  ì •ë³´ë¥¼ êµ¬í•œë‹¤.</li><li><code>String toShortString()</code>: í˜¸ì¶œë˜ëŠ” ë©”ì†Œë“œë¥¼ ì¶•ì•½í•œë‹¤ (ì´ë¦„ë§Œ)</li></ul>



<h2>ìŠ¤í”„ë§ì—ì„œ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ë•Œ</h2>



<ul><li>ìŠ¤í”„ë§ì—ì„œ ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ReCalculatorë¥¼ ì‚¬ìš©í•œë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">// ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ
Calculator calculator = context.getBean("calculator", Calculator.class);

// bean  ì„¤ì •
@Bean
public Calculator calculator() {
    return new ReCalculator();
}</code></pre>



<ul><li><code>ReCalculator</code>ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° <code>Calculator</code> íƒ€ì…ì„ ì‚¬ìš©í•œë‹¤. ì´ê²ƒì„ ReCalculatorë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë°”ê¾¸ë©´ Expectionì´ ë°œìƒí•œë‹¤.</li><li>ì´ìœ ëŠ” ëŸ°íƒ€ì„ì— ìƒì„±í•œ í”„ë¡ì‹œ ê°ì²´ì¸ <code>$Proxy17</code>ë„ <code>ReCalculator</code>êµ¬í˜„ì²´ê°€ ìƒì†ë°›ëŠ” <code>Calculator</code>ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ê¸° ë•Œë¬¸ì´ë‹¤.<br><img src=":/009f247e99e6488b9bb4ab4ee5dd46b8" alt="16c8ef3c565eb530d8521c769360c0de.png"></li><li>bean ê°ì²´ê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•  ë•Œ ì¸í„°í˜ì´ìŠ¤ê°€ ì•„ë‹Œ êµ¬í˜„ì²´ë¥¼ ì´ìš©í•´ì„œ í”„ë¡ì‹œë¥¼ ìƒì„±í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ëœë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">// ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ
AnnotationConfigApplicationContext context =
    new AnnotationConfigApplicationContext(AppContext.class);

ReCalculator calculator = context.getBean("calculator", ReCalculator.class);

// bean ì„¤ì •
@Configuration
@EnableAspectJAutoProxy(proxyTargetClass = true)
public class AppContext {
//...</code></pre>



<ul><li>ì•„ë˜ëŠ” ì‹¤í–‰ ê²°ê³¼ë‹¤</li></ul>



<pre class="wp-block-code"><code class="">ReCalculator.factorial([5]) runtime : 15285343 ns
calculator.factorial(5) = 120
chap07.ReCalculator$$EnhancerBySpringCGLIB$$7bd3a4d7</code></pre>



<blockquote class="wp-block-quote"><p>ReCalculatorë¥¼ ë°›ëŠ”ë‹¤.</p></blockquote>



<ul><li>ë‹¤ìŒì—” excution í•„í„°ì™€ Advice ì ìš© ìˆœì„œì— ëŒ€í•´ì„œ ë§ˆì € ì •ë¦¬í•˜ê² ë‹¤.</li></ul>



<hr class="wp-block-separator is-style-dots"/>



<h1>ìŠ¤í”„ë§ AOPì˜ ì‹¤ì œ #2</h1>



<h2>execution íŒ¨í„´ í‘œí˜„ì‹</h2>



<ul><li><code>execution(public void set*(..))</code> : ë°˜í™˜í˜•ì´ voidì´ê³ , ë©”ì†Œë“œ ì´ë¦„ì˜ setìœ¼ë¡œ ì‹œì‘í•˜ê³  ì¸ìê°€ 0ê°œ ì´ìƒì¸ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.</li><li><code>executation(* dto.*.*())</code> : dto íŒ¨í‚¤ì§€ íƒ•ë¹„ì— ì†í•œ ì¸ìê°€ ì—†ëŠ” ëª¨ë“  ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.</li><li><code>executation(* dto..*.*(..))</code> : dto íŒ¨í‚¤ì§€ ë° í•˜ìœ„ íŒ¨í‚¤ì§€ì— ìˆê³  ì¸ìê°€ 0ê°œ ì´ìƒì¸ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.</li><li><code>execution(Long dto.StudentRepository.getAge(..))</code> : ë°˜í™˜í˜•ì´ Longì¸ StudentRepository íƒ€ì…ì˜ getAge() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.</li><li><code>execution(* get*(*))</code> : ì´ë¦„ì´ getìœ¼ë¡œ ì‹œì‘í•˜ê³  ì¸ìê°€ 1ê°œì¸ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤.</li><li><code>execution(* get*(*, *))</code> : ì´ë¦„ì´ getìœ¼ë¡œ ì‹œì‘í•˜ê³  ì¸ìê°€ 2ê°œì¸ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. Advice ì ìš© ìˆœì„œ</li><li>í•˜ë‚˜ì˜ pointcutì— ì—¬ëŸ¬ Adviceë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">// Aspect ì§€ì • ê°ì²´
@Aspect
public class CacheAspect {

    private Map&lt;Long, Object&gt; cache = new HashMap&lt;&gt;();

    @Pointcut("execution(public * chap07..*(long))")
    public void cacheTarget() {
    }

    @Around("cacheTarget()")
    public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {

        Long number = (Long) joinPoint.getArgs()[0];
        if (cache.containsKey(number)) {
            System.out.printf("CacheAspect: Get the item from Cache [%d]\n", number);
            return cache.get(number);
        }

        Object result = joinPoint.proceed();
        cache.put(number, result);
        System.out.printf("CacheAspect: Put the item in Cache [%d]\n", number);
        return result;
    }

}</code></pre>



<ul><li>ìƒˆë¡œìš´ Aspectë¥¼ êµ¬í˜„í–ˆë‹¤.</li><li>bean ì„¤ì •ì—ì„œ ë‘ê°œì˜ Aspectë¥¼ ì•„ë˜ì™€ ê°™ì´ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">@Configuration
@EnableAspectJAutoProxy
public class AppContextWithCache {

    @Bean
    public CacheAspect cacheAspect() {
        return new CacheAspect();
    }

    @Bean

    public ExecutiveTimeAspect executiveTimeAspect() {
        return new ExecutiveTimeAspect();
    }

    @Bean
    public Calculator calculator() {
        return new RecurrenceCalculator();
    }
}</code></pre>



<ul><li>ìŠ¤í”„ë§ì»¨í…Œì´ë„ˆëŠ” ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•œë‹¤</li></ul>



<pre class="wp-block-code"><code class="">public class MainAspectWithCache {

    public static void main(String[] args) {
        AnnotationConfigApplicationContext context =
            new AnnotationConfigApplicationContext(AppContextWithCache.class);

        Calculator calculator = context.getBean("calculator", Calculator.class);
        calculator.factorial(7);
        calculator.factorial(7);
        calculator.factorial(3);
        calculator.factorial(7);
        calculator.factorial(7);
        calculator.factorial(3);
        calculator.factorial(5);
        calculator.factorial(5);
        calculator.factorial(5);
        calculator.factorial(5);
        context.close();
    }

}</code></pre>



<ul><li>ì‹¤í–‰ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤</li></ul>



<pre class="wp-block-code"><code class="">RecurrenceCalculator.factorial([7]) runtime : 16534 ns
CacheAspect: Put the item in Cache [7]
CacheAspect: Get the item from Cache [7]
RecurrenceCalculator.factorial([3]) runtime : 6481 ns
CacheAspect: Put the item in Cache [3]
CacheAspect: Get the item from Cache [7]
CacheAspect: Get the item from Cache [7]
CacheAspect: Get the item from Cache [3]
RecurrenceCalculator.factorial([5]) runtime : 8021 ns
CacheAspect: Put the item in Cache [5]
CacheAspect: Get the item from Cache [5]
CacheAspect: Get the item from Cache [5]
CacheAspect: Get the item from Cache [5]</code></pre>



<blockquote class="wp-block-quote"><p>ìºì‹œì— ê°ì²´ê°€ ì¡´ì¬í•˜ë©´ ê³„ì‚°ì„ í•˜ì§€ ì•Šê³  ìºì‹œë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</p></blockquote>



<ul><li>ì´ë ‡ê²Œ Aspectì˜ ì‹¤í–‰ìˆœì„œë¥¼ ì•Œ ìˆ˜ ìˆë‹¤</li><li>[CacheAspect] Proxy â†’ [ExecutiveTimeAspect] Proxy â†’ [RecurrenceCacluator] Instance</li></ul>



<h3>@Order</h3>



<ul><li>ì—¬ëŸ¬ê°œì˜ Aspectë¥¼ ì§€ì •í•œë‹¤ê³  í•­ìƒ ì˜ë„ëœëŒ€ë¡œ ì‹¤í–‰ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.</li><li>ìˆœì„œ ì§€ì •ì´ í•„ìš”í•œ ê²½ìš° Aspectê°€ ì§€ì •ëœ í´ë˜ìŠ¤ì— @Order ì–´ë…¸í…Œì´ì…˜ì„ ì§€ì •í•˜ë©´ëœë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">@Aspect
@Order(2)
public class CacheAspect {
//..

@Aspect
@Order(1)
public class ExecutiveTimeAspect {
//..</code></pre>



<ul><li>ì‹¤í–‰ ê²°ê³¼ëŠ” Cacheë¥¼ ë’¤ì— íƒ€ë„ë¡ ë‹¬ë¼ì§„ë‹¤</li></ul>



<pre class="wp-block-code"><code class="">CacheAspect: Put the item in Cache [7]
RecurrenceCalculator.factorial([7]) runtime : 201529 ns
CacheAspect: Get the item from Cache [7]
RecurrenceCalculator.factorial([7]) runtime : 276267 ns
CacheAspect: Put the item in Cache [3]
//... ì¤‘ëµ
CacheAspect: Get the item from Cache [5]
RecurrenceCalculator.factorial([5]) runtime : 99159 ns
CacheAspect: Get the item from Cache [5]
RecurrenceCalculator.factorial([5]) runtime : 85201 ns
CacheAspect: Get the item from Cache [5]
RecurrenceCalculator.factorial([5]) runtime : 88659 ns</code></pre>



<h3>@Pointcutì˜ ì¬ì‚¬ìš©</h3>



<ul><li>CacheAspectì™€ ExecutiveTimeAspectë¥¼ êµ¬ì„±í•˜ë©´ì„œ @Pointcut ì–´ë…¸í…Œì´ì…˜ì˜ í•„í„°ë¥¼ ì‚¬ìš©í•´ ëŒ€ìƒì„ ì§€ì •í•˜ê³ ìˆë‹¤.</li><li>ë‘˜ë‹¤ ê°™ì€ Joinpointë¥¼ ë°”ë¼ë³´ê³  ìˆê³  ì´ê²ƒì„ í•œìª½ìœ¼ë¡œ í•©ì¹  ìˆ˜ ìˆë‹¤.</li><li>ì•„ë˜ì—ì„œëŠ” CacheAspectì—ì„œ ExevuciteTimeAspectìª½ì˜ Joinpointë¥¼ ë°”ë¼ë³´ë„ë¡ ë§Œë“¤ì–´ë³´ê² ë‹¤</li></ul>



<pre class="wp-block-code"><code class="">// CacheAspect

//    @Pointcut("execution(public * chap07..*(long))")
//    public void cacheTarget() {
//    }
@Around("ExecutiveTimeAspect.publicTarget()")
public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {
//..

// ExecutiveTimeAspect
@Pointcut(value = "execution(public * chap07..*(..))")
public void publicTarget() {
}
//..</code></pre>



<blockquote class="wp-block-quote"><p>@Pointcut ì–´ë…¸í…Œì´ì…˜ì„ ë°›ëŠ” ë©”ì†Œë“œë¥¼ publicìœ¼ë¡œ ë³€ê²½í•˜ë©´ ë‹¤ë¥¸ Aspectì—ì„œ Joinpointë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆë‹¤.</p></blockquote>



<ul><li>@Pointcutì„ ì™¸ë¶€ë¡œ ë¹¼ë‚´ì–´ ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.</li><li>ìš°ì„  joinpointë§Œì„ ìœ„í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ @Pointcut ì–´ë…¸í…Œì´ì…˜ê³¼ í•„í„°ë¥¼ ì ìš©í•œë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">// CommonPointcut
public class CommonPointcut {
    @Pointcut(value = "execution(public * chap07..*(..))")
    public void commonTarget() {
    }
}</code></pre>



<ul><li>ê·¸ë‹¤ìŒ ê° Aspectì˜ @Around í•„ë“œë¥¼ ìˆ˜ì •í•œë‹¤.</li></ul>



<pre class="wp-block-code"><code class="">// CacheAspect
@Around("CommonPointcut.commonTarget()")
public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {
    //..

    // ExecutiveTimeAspect
@Around("CommonPointcut.commonTarget()")
public Object measure(ProceedingJoinPoint joinPoint) throws Throwable {
    //....</code></pre>



<ul><li>ì´ë ‡ê²Œ í•˜ë©´ joinpointë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.<br><img src=":/32b37da8e21746afb764cc178680f2c8" alt="941b87aa6f46c2683fb1442572a2ce93.png"></li><li>ì •ë§ ì¢‹ë„¤</li></ul>
		</li>